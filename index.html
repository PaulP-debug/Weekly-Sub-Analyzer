function analyze() {
    const purchases = parsePurchases(document.getElementById("purchaseData").value);
    const claims = parseClaims(document.getElementById("claimData").value);
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    // Update summary
    updateSummary(purchases);

    // Loop through each pack type
    for (let amt in PACKS) {
        const packName = PACKS[amt].name;
        let packPurchases = purchases
            .filter(p => p.pack_amount === parseFloat(amt))
            .sort((a, b) => a.purchase_ts - b.purchase_ts);

        let intervals = [];

        for (let p of packPurchases) {
            const last = intervals[intervals.length - 1];

            if (last) {
                const lastEnd = new Date(last.purchase_ts.getTime() + 7 * 24 * 3600 * 1000); // 7 days
                if (p.purchase_ts <= lastEnd) {
                    // Overlaps with previous interval, merge: extend last interval if needed
                    continue; // still only one interval for overlapping purchases
                } else {
                    // Non-overlapping: create new interval
                    intervals.push({ pack_name: packName, pack_amount: parseFloat(amt), purchase_ts: p.purchase_ts });
                }
            } else {
                // First purchase
                intervals.push({ pack_name: packName, pack_amount: parseFloat(amt), purchase_ts: p.purchase_ts });
            }
        }

        // Create table for each interval
        intervals.forEach(interval => {
            resultsDiv.appendChild(createTable(interval, 7, claims)); // totalDays = 7 for each purchase
        });

        // Handle case where there are no purchases for this pack
        if (packPurchases.length === 0) {
            const emptyInterval = { pack_name: packName, pack_amount: parseFloat(amt), purchase_ts: new Date() };
            resultsDiv.appendChild(createTable(emptyInterval, 0, claims));
        }
    }
}
