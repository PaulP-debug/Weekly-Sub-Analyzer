<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weekly Subscription Analyzer</title>
<style>
 body { font-family: Arial, sans-serif; padding: 20px; }
 textarea { width: 100%; height: 180px; font-family: monospace; margin-top: 5px; }
 .bronze { background: #cd7f32; color: white; }
 .silver { background: #c0c0c0; color: black; }
 .gold { background: #ffd700; color: black; }
 .grid { display: grid; grid-template-columns: repeat(7, 1fr); margin-top: 10px; }
 .day { border: 1px solid #ccc; padding: 4px; height: 70px; font-size: 12px; }
 .claimed { background: #c6efce; }
 .missed { background: #ffc7ce; }
 .future { background: #d9d9d9; }
 button { padding:10px 25px; margin-top:20px; font-size:16px; }
</style>
</head>
<body>

<h1>Weekly Subscription Analyzer</h1>

<h2>Purchases Data</h2>
<textarea id="box1" placeholder="Paste Purchases Data here..."></textarea>

<h2>Game Flow Data</h2>
<textarea id="box2" placeholder="Paste Game Flow Data here..."></textarea>

<button id="analyzeBtn">Analyze Subscription</button>

<h2>Results</h2>
<div id="results"></div>

<script>
function parseDate(x){
    let d = new Date(x.trim().replace(/\s+/,'T'));
    if(isNaN(d)) return null;
    return d;
}

function format24(d){
    return d.getFullYear() + '-' +
           String(d.getMonth()+1).padStart(2,'0') + '-' +
           String(d.getDate()).padStart(2,'0') + ' ' +
           String(d.getHours()).padStart(2,'0') + ':' +
           String(d.getMinutes()).padStart(2,'0') + ':' +
           String(d.getSeconds()).padStart(2,'0');
}

function analyze(){
    const b1 = document.getElementById('box1').value.trim().split(/\n/);
    const b2 = document.getElementById('box2').value.trim().split(/\n/);
    if(b1.length<4 || b2.length<3){
        alert('Paste full data!');
        return;
    }

    let subs = [];
    for(let i=0;i<b1.length;i+=4){
        if(i+3 >= b1.length) continue;
        let status = b1[i].trim();
        let updated = b1[i+1].trim().split(/\t/)[0]; // take only the date
        let ptype = b1[i+2].trim();
        let amt = parseFloat(b1[i+3].trim());
        if(status!=='Succeed' || ptype!=='sub_pack') continue;
        let tier = amt===7?'Bronze':amt===30?'Silver':amt===90?'Gold':null;
        if(!tier) continue;
        let start = parseDate(updated);
        if(!start) continue;
        let end = new Date(start.getTime() + 7*24*3600*1000);
        subs.push({tier,start,end});
    }

    let claims = [];
    for(let i=0;i<b2.length;i+=3){
        if(i+2 >= b2.length) continue;
        let values = b2[i].trim().split(/\t/);
        let tierName = b2[i+1].trim();
        let ts = b2[i+2].trim().split(/\t/)[2]; // timestamp
        let tier=null;
        if(tierName==='Weekly Subscription'){
            if(parseFloat(values[1])===0.5 && parseFloat(values[2])===2000) tier='Bronze';
            if(parseFloat(values[1])===2 && parseFloat(values[2])===10000) tier='Silver';
            if(parseFloat(values[1])===5.5 && parseFloat(values[2])===40000) tier='Gold';
        }
        if(!tier) continue;
        let date=parseDate(ts);
        if(!date) continue;
        claims.push({tier, ts: date});
    }

    let html='';
    subs.forEach(s=>{
        const color = s.tier==='Bronze'?'bronze':s.tier==='Silver'?'silver':'gold';
        html += `<h3 class="${color}">${s.tier} Subscription (${format24(s.start)} â†’ ${format24(s.end)})</h3>`;
        let days=[];
        for(let d=0;d<7;d++){
            let dayStart = new Date(s.start);
            dayStart.setHours(8,0,0,0);
            dayStart.setDate(dayStart.getDate() + d);
            let dayEnd = new Date(dayStart.getTime() + 24*3600*1000);
            let claim = claims.find(c=>{
                let cAdj = new Date(c.ts);
                if(cAdj.getHours()<8) cAdj.setDate(cAdj.getDate()-1);
                return c.tier===s.tier && cAdj>=dayStart && cAdj<dayEnd;
            });
            let today = new Date();
            let cls = claim?'claimed':(dayEnd>today?'future':'missed');
            days.push(`<div class="day ${cls}"><b>Day ${d+1}</b><br>${format24(dayStart)}${claim? '<br>Claimed at ' + format24(claim.ts):''}${cls==='future'?'<br>Future':''}${cls==='missed'?'<br>Not Claimed':''}</div>`);
        }
        html += `<div class="grid">${days.join('')}</div>`;
    });

    document.getElementById('results').innerHTML=html;
}

document.getElementById('analyzeBtn').addEventListener('click', analyze);
</script>

<p style="margin-top:40px; font-size:12px;">Signature by: Paul P</p>
</body>
</html>
