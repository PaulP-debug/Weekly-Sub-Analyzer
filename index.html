<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weekly Subscription Analyzer</title>
<style>
 body { font-family: Arial, sans-serif; padding: 20px; }
 h1 { margin-bottom: 20px; }
 h2 { margin-top: 30px; }

 .container {
   display: flex;
   gap: 20px;
   width: 100%;
 }

 textarea {
   width: 100%;
   height: 240px;
   font-family: monospace;
   padding: 8px;
   resize: vertical;
 }

 .bronze { background: #cd7f32; color:white; padding:6px; }
 .silver { background: #c0c0c0; color:black; padding:6px; }
 .gold   { background: #ffd700; color:black; padding:6px; }

 .grid {
   display: grid;
   grid-template-columns: repeat(7, 1fr);
   margin-top: 10px;
 }
 .day {
   border: 1px solid #ccc;
   padding: 6px;
   height: 90px;
   font-size: 12px;
 }
 .claimed { background: #c6efce; }
 .missed  { background: #ffc7ce; }
 .future  { background: #e0e0e0; }
</style>
</head>

<body>
<h1>Weekly Subscription Analyzer</h1>

<div class="container">
  <div style="flex:1">
    <h2>Purchases Data</h2>
    <textarea id="box1" placeholder="Paste Purchases Data here..."></textarea>
  </div>

  <div style="flex:1">
    <h2>Game Flow Data</h2>
    <textarea id="box2" placeholder="Paste Game Flow Data here..."></textarea>
  </div>
</div>

<button onclick="analyze()" style="padding:10px 25px; margin-top:20px;">Analyze</button>

<h2>Results</h2>
<div id="results"></div>

<script>
function parseTS(x){ return new Date(x.replace(/\s+/,"T")); }

function analyze(){
  const b1 = document.getElementById("box1").value.trim().split(/\n/);
  const b2 = document.getElementById("box2").value.trim().split(/\n/);

  let subs=[];
  for (let i=1;i<b1.length;i++){
    let row=b1[i].split(/\t+/);
    if(row.length<8) continue;

    let status=row[0].trim();
    let updated=row[1].trim();
    let ptype=row[6].trim();
    let amt=parseFloat(row[7]);

    if(ptype!=="sub_pack") continue;
    if(status!=="Succeed") continue;

    let tier = amt===7? "Bronze" :
               amt===30? "Silver" :
               amt===90? "Gold" : null;

    if(!tier) continue;

    let start=parseTS(updated);
    let end=new Date(start.getTime()+7*86400000);

    subs.push({tier,start,end});
  }

  let claims=[];
  for (let i=1;i<b2.length;i++){
    let row=b2[i].split(/\t+/);
    if(row.length<10) continue;

    let unplayed=parseFloat(row[1]);
    let gc=parseFloat(row[2]);
    let ts=row[9].trim();

    let tier = 
      (unplayed===0.50 && gc===2000)? "Bronze" :
      (unplayed===2    && gc===10000)? "Silver" :
      (unplayed===5.5  && gc===40000)? "Gold" : null;

    if(!tier) continue;

    claims.push({tier,ts:parseTS(ts)});
  }

  let html="";

  subs.forEach((sub,idx)=>{
    let cls = sub.tier==="Bronze"?"bronze":
              sub.tier==="Silver"?"silver":
              "gold";

    html += `<h3 class="${cls}">
              ${sub.tier} Subscription<br>
              ${sub.start.toLocaleString()} â†’ ${sub.end.toLocaleString()}
             </h3>`;

    let days=[];

    for(let d=0; d<7; d++){
      let ds = new Date(sub.start.getTime()+d*86400000);
      let de = new Date(ds.getTime()+86400000);

      let claim = claims.find(
        c => c.tier===sub.tier && c.ts>=ds && c.ts<de
      );

      let today = new Date();
      let state = claim ? "claimed" :
                   (de>today ? "future" : "missed");

      days.push(`
        <div class="day ${state}">
          <b>Day ${d+1}</b><br>
          ${ds.toLocaleDateString()}<br>
          ${
            claim ? "Claimed" :
            state==="future" ? "To be claimed" :
            "Not claimed"
          }
        </div>
      `);
    }

    html += `<div class="grid">${days.join("")}</div>`;
  });

  document.getElementById("results").innerHTML = html;
}
</script>

<p style="margin-top:40px;font-size:12px;">Signature by: Paul P</p>
</body>
</html>
