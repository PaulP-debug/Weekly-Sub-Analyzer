<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weekly Subscription Analyzer</title>
<style>
 body { font-family: Arial, sans-serif; padding: 20px; }
 h2 { margin-top: 20px; }
 textarea { width: 100%; height: 120px; font-family: monospace; }
 table { border-collapse: collapse; width: 100%; margin-top: 10px; }
 th, td { border: 1px solid #ccc; padding: 6px; font-size: 14px; }
 .bronze { background: #cd7f32; color: white; }
 .silver { background: #c0c0c0; color: black; }
 .gold { background: #ffd700; color: black; }
 .grid { display: grid; grid-template-columns: repeat(7, 1fr); margin-top: 10px; }
 .day { border: 1px solid #ccc; padding: 4px; height: 70px; font-size: 12px; }
 .claimed { background: #c6efce; }
 .missed { background: #ffc7ce; }
 .future { background: #d9d9d9; }
 .flex-container { display: flex; gap: 10px; }
 .input-box { flex: 1; }
 .subscription-panel { flex: 1; max-height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 5px; }
 .subscription-row { padding: 3px; margin-bottom: 2px; border-radius: 3px; color: white; font-size: 14px; }
 .bronze-row { background: #cd7f32; }
 .silver-row { background: #c0c0c0; color: black; }
 .gold-row { background: #ffd700; color: black; }
</style>
</head>
<body>
<h1>Weekly Subscription Analyzer</h1>
<div class="flex-container">
  <div class="input-box">
    <h2>Purchases Data</h2>
    <textarea id="box1" placeholder="Paste Purchases Data here..."></textarea>
    <h2>Game Flow Data</h2>
    <textarea id="box2" placeholder="Paste Game Flow Data here..."></textarea>
    <button onclick="analyze()" style="padding:10px 25px; margin-top:10px; font-size:16px;">Analyze</button>
  </div>
  <div class="subscription-panel" id="subscriptionPanel">
    <h2>Valid Subscriptions</h2>
    <div id="subscriptionsList"></div>
  </div>
</div>
<h2>Results</h2>
<div id="results"></div>
<script>
function parseTS(x){ return new Date(x.replace(/\s+/,'T')); }

function analyze(){
  const b1 = document.getElementById('box1').value.trim().split(/\n/);
  const b2 = document.getElementById('box2').value.trim().split(/\n/);
  let subs=[];

  // Process Purchases
  for(let i=0;i<b1.length;i+=4){
    const status = b1[i].trim();
    const updatedLine = b1[i+1];
    const typeLine = b1[i+2];
    const amountLine = b1[i+3];
    if(!updatedLine || !typeLine || !amountLine) continue;

    const updatedParts = updatedLine.split(/\t/);
    const updated = updatedParts[0];
    const ptype = typeLine.trim();
    const amt = parseFloat(amountLine.trim());

    if(ptype!=='sub_pack') continue;
    if(status!=='Succeed') continue;

    let tier = amt===7? 'Bronze': amt===30? 'Silver': amt===90? 'Gold': null;
    if(!tier) continue;

    let start = parseTS(updated);
    let end = new Date(start.getTime() + 7*24*3600*1000);

    subs.push({tier,start,end,purchase:updated});
  }

  // Show valid subscriptions
  const subPanel = document.getElementById('subscriptionsList');
  subPanel.innerHTML = '';
  subs.forEach(s=>{
    const row = document.createElement('div');
    row.className = 'subscription-row ' + (s.tier==='Bronze'?'bronze-row':s.tier==='Silver'?'silver-row':'gold-row');
    row.textContent = s.tier + ' - Purchased: ' + s.purchase + ' - Amount: ' + (s.tier==='Bronze'?7:s.tier==='Silver'?30:90);
    subPanel.appendChild(row);
  });
}
</script>
<p style="margin-top:20px; font-size:12px;">Signature by: Paul P</p>
</body>
</html>
