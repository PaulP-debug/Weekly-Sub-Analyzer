<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weekly Subscription Analyzer</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  h1 { margin-bottom: 20px; }
  .container { display: flex; gap: 20px; }
  .inputs { flex: 1; display: flex; flex-direction: column; gap: 10px; }
  textarea { width: 100%; height: 120px; font-family: monospace; font-size: 13px; }
  button { padding:10px 20px; font-size:16px; margin-top:5px; }
  .summary { flex: 1; border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: auto; }
  .subscription-row { padding: 6px; border-bottom: 1px solid #ddd; }
  .bronze { background: #cd7f32; color: white; }
  .silver { background: #c0c0c0; color: black; }
  .gold { background: #ffd700; color: black; }
</style>
</head>
<body>

<h1>Weekly Subscription Analyzer</h1>
<div class="container">
  <div class="inputs">
    <textarea id="purchases" placeholder="Paste Purchases Data here..."></textarea>
    <textarea id="gameflow" placeholder="Paste Game Flow Data here..."></textarea>
    <button onclick="analyze()">Analyze Subscription</button>
  </div>
  <div class="summary" id="subscriptionSummary">
    <h3>Valid Subscriptions</h3>
    <div id="summaryRows"></div>
  </div>
</div>

<script>
function parseTS(x){ return new Date(x.replace(/\s+/,'T')); }

function analyze() {
  const purchaseLines = document.getElementById('purchases').value.trim().split(/\n/);
  const subscriptions = [];

  for(let i=0; i<purchaseLines.length; i+=4) { // 4 lines per purchase
    const status = purchaseLines[i].trim();
    const updatedLine = purchaseLines[i+1].trim();
    const ptype = purchaseLines[i+2].trim();
    const amt = parseFloat(purchaseLines[i+3]);
    
    if(status !== "Succeed") continue;
    if(!['sub_pack', 'start_pack', 'cash_shield', 'first'].includes(ptype)) continue;
    
    const updated = updatedLine.split('\t')[0]; // take the timestamp
    subscriptions.push({ptype, amt, updated});
  }

  const summaryDiv = document.getElementById('summaryRows');
  summaryDiv.innerHTML = '';

  subscriptions.forEach(sub => {
    const colorClass = sub.ptype === 'sub_pack' ? 'bronze' : sub.ptype === 'start_pack' ? 'silver' : sub.ptype === 'cash_shield' ? 'gold' : '';
    const row = document.createElement('div');
    row.className = `subscription-row ${colorClass}`;
    row.textContent = `${sub.ptype} - ${sub.amt} - ${sub.updated}`;
    summaryDiv.appendChild(row);
  });
}
</script>

</body>
</html>
